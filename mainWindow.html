<!DOCTYPE html>
<html lang="en">
<head>
    <title>Electron Shopping</title>
        <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
        <style>
            .flex-row-container {
              display: flex;
              align-items: stretch;
             }
            
            .flex-row-container > div {
              text-align: center;
            }
            .flex-graph-container {
                display: flex;
                flex-direction: column;
            }

            .flex-graph-container > div {
                text-align: center;
                margin-bottom: 5rem;
            }
            ol li:first-child { list-style:none }
        </style>
</head>
<body>
    <nav>
        <div class="nav-wrapper">
            <a class="brand-logo center">Shopping using Electron</a>
        </div>
    </nav>
    <article>
    <div class="flex-row-container">   
        <div style='flex-grow: 1' class='sm'>
            <div class="flex-graph-container">
                
                <div style="height:12vh; width:20vw">
                    <canvas id="myChart1" width="50" height="30"></canvas>
                </div>
                <div style="height:18vh; width:20vw">
                    <canvas id="myChart2" width="50" height="30"></canvas>
                </div>
                <div style="height:18vh; width:20vw">
                    <canvas id="myChart3" width="50" height="40"></canvas>
                </div>
            </div>
        </div>
        <div style='flex-grow: 11' class='sm'>
                <div class="card card-body" >
                    <ul>
                        <li class="collection-header nostyle">
                                <div class='flex-row-container'>
                                    <div style='flex-grow: 1' class='sm'>#</div>
                                    <div style='flex-grow: 6' class='sm'>Item Name</div>
                                    <div style='flex-grow: 1' class='sm'>Qty</div>
                                    <div style='flex-grow: 1' class='sm'>Price</div>
                                    <div style='flex-grow: 1' class='sm'>Sum</div>
                                </div>                           
                        </li>
                    </ul>
                </div>
        </div>

    </div>
    </article>

    <footer style="position: fixed; bottom: 0; width: 100%;">
        <div class="right sm my-3 mx-2">
        Total Items:<input class="right sm" type="text" id="total" value=0 size=4 readonly/>
        <br/>Total Cost:<input class="right sm" type="text" id="cost" value=0 size=6 readonly/>
        <br/>CGST: <div class="right xs" id="cgst"> </div> <br/>
        SGST: <div class="right xs" id="sgst" ></div>
    </div>
    </footer>

    <script>
        const electron = require('electron');
        const {ipcRenderer} = electron;
        const ul = document.querySelector('ul');

        ipcRenderer.on('item:add', (e,{item, qty, price}) => {
            ul.className = 'collection'
            const li = document.createElement('li');
            let row = "<div class='flex-row-container'>"
            row += "<div style='flex-grow: 1' class='sm'>" + (ul.children.length) + "</div>"
            row += "<div style='flex-grow: 6' class='sm'>" + item + "</div>"
            row += "<div style='flex-grow: 1' class='sm'>" + qty + "</div>"
            row += "<div style='flex-grow: 1' class='sm'>" + price + "</div>"
            let sum = qty * price;
            row += "<div style='flex-grow: 1' class='sm'>" + sum + "</div></div>"
             
            const itemText = document.createTextNode(row);
            li.className = 'collection-item'
            li.innerHTML = row;
            
            ul.appendChild(li);
            const total = document.querySelector('#total');
            const cost = document.querySelector('#cost');
            const cgst = document.querySelector('#cgst');
            const sgst = document.querySelector('#sgst');
            cost.value = parseFloat(cost.value) + (qty * price)
            cgst.textContent = 0.09 * parseInt(cost.value)
            sgst.textContent = 0.09 * parseInt(cost.value)
            
            total.value = ul.children.length - 1;

        } )

        ipcRenderer.on('item:clear', () => {
            console.log(ul.children.length)
            if(ul.children.length > 1) {
                ul.innerHTML = "<li class='collection-header nostyle'> " + 
                                "<div class='flex-row-container'>" +
                                    "<div style='flex-grow: 1' class='sm'>#</div>" +
                                    "<div style='flex-grow: 6' class='sm'>Item Name</div>" +
                                    "<div style='flex-grow: 1' class='sm'>Qty</div>" +
                                    "<div style='flex-grow: 1' class='sm'>Price</div>" +
                                    "<div style='flex-grow: 1' class='sm'>Sum</div>" +
                                "</div>" +                          
                        "</li>";
                ul.className = ''
            } 
            const total = document.querySelector('#total');
            const cost = document.querySelector('#cost');
            const cgst = document.querySelector('#cgst');
            const sgst = document.querySelector('#sgst');
            cost.value = 0.0
            cgst.textContent = 0.0
            sgst.textContent = 0.0            
            total.value = ul.children.length -1;            
        } )   
        
        ul.addEventListener('dblclick', (e) => {
            
            console.log(e.target.localName === 'div')
            if(e.target.localName !== 'div') {
                let qty = e.target.querySelector('.flex-row-container > div:nth-child(3)').textContent;
                let price = e.target.querySelector('.flex-row-container > div:nth-child(4)').textContent;

                let itemcost = parseFloat(parseFloat(qty) * parseFloat(price))
                e.target.remove();
                const cost = document.querySelector('#cost');
                const cgst = document.querySelector('#cgst');
                const sgst = document.querySelector('#sgst');
                cost.value = parseFloat(cost.value) - itemcost
                cgst.textContent = 0.09 * parseInt(cost.value)
                sgst.textContent = 0.09 * parseInt(cost.value)                
            }
            if(ul.children.length==1) ul.className = ''
            const total = document.querySelector('#total');
            total.value = ul.children.length - 1; 


        }
        )

        
    </script>
    <script>
        const Chart = require('chart.js');
        var ctx = document.getElementById("myChart1");
        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ["Red", "Blue", "Yellow", "Green", "Purple", "Orange"],
                datasets: [{
                    label: '# of Items',
                    data: [12, 19, 3, 5, 2, 3],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255,99,132,1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero:true
                        }
                    }]
                }
            }
        });

        ctx = document.getElementById("myChart2");
        var myDoughnutChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: [10, 20, 30],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255,99,132,1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)'
                    ],
                    borderWidth: 1
                }],

                // These labels appear in the legend and in the tooltips when hovering different arcs
                labels: [
                    'Red',
                    'Blue',
                    'Yellow'
                ]
            }
        });

        ctx = document.getElementById("myChart3");
        var myRadarChart = new Chart(ctx,
            {
                "type":"radar",
                "data": {
                    "labels":["Eating","Drinking","Sleeping","Designing","Coding","Cycling","Running"],
                    "datasets":[
                        {
                            "label":"My First Dataset","data":[65,59,90,81,56,55,40],
                            "fill":true,
                            "backgroundColor":"rgba(255, 99, 132, 0.2)",
                            "borderColor":"rgb(255, 99, 132)",
                            "pointBackgroundColor":"rgb(255, 99, 132)",
                            "pointBorderColor":"#fff",
                            "pointHoverBackgroundColor":"#fff",
                            "pointHoverBorderColor":"rgb(255, 99, 132)"
                        },
                        {
                            "label":"My Second Dataset",
                            "data":[28,48,40,19,96,27,100],
                            "fill":true,
                            "backgroundColor":"rgba(54, 162, 235, 0.2)",
                            "borderColor":"rgb(54, 162, 235)",
                            "pointBackgroundColor":"rgb(54, 162, 235)",
                            "pointBorderColor":"#fff",
                            "pointHoverBackgroundColor":"#fff",
                            "pointHoverBorderColor":"rgb(54, 162, 235)"}]
                        },
                        "options":{
                            "elements":{
                                "line":{
                                    "tension":0,
                                    "borderWidth":3
                                }
                            }
                        }
                    });

        </script>
</body>
</html>